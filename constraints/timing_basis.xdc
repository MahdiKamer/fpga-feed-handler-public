##############################################################################
# timing_basis.xdc - Base clock definitions for fpga-feed-handler-public
##############################################################################

# ------------------------------------------------------------------
# 200 MHz differential reference clock (input to clk_wiz/MMCM)
# ------------------------------------------------------------------
# If clk_wiz.xdc already defines this, comment this one to avoid duplication.
#create_clock -name clk_200MHz -period 5.000 [get_ports clk_200_p]

# ------------------------------------------------------------------
# Clocks generated by clk_wiz (fabric/system clocks)
# ------------------------------------------------------------------

# Adjust if your clk_wiz output nets or instantiation differ.
create_generated_clock -name fabric_clk \
    -source [get_pins clk_wiz_inst/clk_in1_p] \
    [get_pins clk_wiz_inst/clk_out1] \
    -divide_by 1

create_generated_clock -name gtx_clk90 \
    -source [get_pins clk_wiz_inst/clk_in1_p] \
    [get_pins clk_wiz_inst/clk_out2] \
    -divide_by 1

# ------------------------------------------------------------------
# Primary I/O clocks at the PHY pins (defined at FPGA boundary)
# ------------------------------------------------------------------
create_clock -name rgmii_rx_clk -period 8.000 [get_ports rgmii_rx_clk]
# ------------------------------------------------------------------
# Tell Vivado that rgmii_tx_clk is a generated clock driven by the MAC core.
# Adjust the instance/pin path to match the design hierarchy.
# ------------------------------------------------------------------
create_generated_clock -name rgmii_tx_clk \
    -source [get_pins eth_mac_1g_rgmii_fifo_inst/gtx_clk] \
    [get_ports rgmii_tx_clk] \
    -divide_by 1

# ------------------------------------------------------------------
# Clock domain relationships
# ------------------------------------------------------------------
# MAC uses async FIFOs between fabric_clk and the RGMII I/O domains.
# Declare them asynchronous to prevent false timing violations.
set_clock_groups -asynchronous \
    -group [get_clocks rgmii_rx_clk] \
    -group [get_clocks rgmii_tx_clk] \
    -group [get_clocks {fabric_clk gtx_clk90}]

# ------------------------------------------------------------------
# TX path timing (FPGA -> PHY)
# ------------------------------------------------------------------

set_output_delay -clock [get_clocks rgmii_tx_clk] -min -1.2 [get_ports rgmii_tx_ctl]
set_output_delay -clock [get_clocks rgmii_tx_clk] -max  2.0 [get_ports rgmii_tx_ctl]

set_output_delay -clock [get_clocks rgmii_tx_clk] -min -1.2 [get_ports rgmii_txd[3]]
set_output_delay -clock [get_clocks rgmii_tx_clk] -max  2.0 [get_ports rgmii_txd[3]]

set_output_delay -clock [get_clocks rgmii_tx_clk] -min -1.2 [get_ports rgmii_txd[2]]
set_output_delay -clock [get_clocks rgmii_tx_clk] -max  2.0 [get_ports rgmii_txd[2]]

set_output_delay -clock [get_clocks rgmii_tx_clk] -min -1.2 [get_ports rgmii_txd[1]]
set_output_delay -clock [get_clocks rgmii_tx_clk] -max  2.0 [get_ports rgmii_txd[1]]

set_output_delay -clock [get_clocks rgmii_tx_clk] -min -1.2 [get_ports rgmii_txd[0]]
set_output_delay -clock [get_clocks rgmii_tx_clk] -max  2.0 [get_ports rgmii_txd[0]]

# ------------------------------------------------------------------
# RX path timing (PHY -> FPGA)
# ------------------------------------------------------------------
set_input_delay -clock [get_clocks rgmii_rx_clk] -min 1.0 [get_ports rgmii_rx_ctl]
set_input_delay -clock [get_clocks rgmii_rx_clk] -max 2.6 [get_ports rgmii_rx_ctl]

set_input_delay -clock [get_clocks rgmii_rx_clk] -min 1.0 [get_ports rgmii_rxd[3]]
set_input_delay -clock [get_clocks rgmii_rx_clk] -max 2.6 [get_ports rgmii_rxd[3]]

set_input_delay -clock [get_clocks rgmii_rx_clk] -min 1.0 [get_ports rgmii_rxd[2]]
set_input_delay -clock [get_clocks rgmii_rx_clk] -max 2.6 [get_ports rgmii_rxd[2]]

set_input_delay -clock [get_clocks rgmii_rx_clk] -min 1.0 [get_ports rgmii_rxd[1]]
set_input_delay -clock [get_clocks rgmii_rx_clk] -max 2.6 [get_ports rgmii_rxd[1]]

set_input_delay -clock [get_clocks rgmii_rx_clk] -min 1.0 [get_ports rgmii_rxd[0]]
set_input_delay -clock [get_clocks rgmii_rx_clk] -max 2.6 [get_ports rgmii_rxd[0]]